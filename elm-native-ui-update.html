<!DOCTYPE html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title> The future of Elm + React Native - Ossi Hanhinen</title>
  <meta name="description" content="The future of Elm + React Native">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./css/main.css">
</head>
<body>
  <section class="contain post">
    <a href="./" class="back-link">&laquo; Home</a>

    <header class="post-header">
  
  <h3>Elm Native UI</h3>
  
  <h1 class="post-title">The future of Elm + React Native</h1>
  
</header>
<div class="post-meta">
  <img class="profile-pic" src="./img/profile_tiny.jpg" alt>
  <h3 class="author">
    <span>Ossi Hanhinen</span>
    <a href="https://twitter.com/ohanhi">@ohanhi</a>
  </h3>
  <p class="post-date">March 21, 2016</p>
</div>

<hr>

<h3>Read this to</h3>
<ul class="post-reasons">
  
  <li>get an inside look into how Elm Native UI has evolved</li>
  
</ul>

<h3>I expect you to know</h3>
<ul class="post-prereqs">
  
  <li>what React Native is</li>
  
  <li>some Elm</li>
  
</ul>

<hr> <p><em><a href="https://github.com/elm-native-ui/elm-native-ui">Elm Native UI</a> aims to let people build mobile apps in Elm using React Native.</em></p>
<p><a href="https://github.com/elm-native-ui/elm-native-ui"><img src="./img/elm-native-dribbble.png" /></a> <small class="caption">Elm Native UI <a href="https://dribbble.com/shots/2383347-Elm-Native-logo">logo</a> by <a href="http://paulyoung.me/">Paul Young</a></small></p>
<p>I wrote a <a href="./elm-native-ui.html">post</a> about <a href="https://github.com/elm-native-ui/elm-native-ui">Elm Native UI</a> a month ago. Since then, a lot has happened with the project. I had a chat with Evan Czaplicki on how things really should work. <a href="https://twitter.com/sefnap/">Yusef</a> and <a href="https://twitter.com/eeue56">Noah</a> helped move away from ports. I restructured the project to be less a proof-of-concept and more a library.</p>
<p>This post gives an overview of the major changes made, and paints a picture of how I see the future at this point.</p>
<h2 id="what-we-had-before">What we had before</h2>
<p>A month ago we had an intricate setup that was using ports for outputting the UI and getting events from React Native. It worked, but there were many annoyances with the approach. Among other things, we had to encode the view into a signal of JSON.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- &quot;main&quot;</span>
port viewTree <span class="fu">:</span> <span class="dt">Signal</span> <span class="dt">Json.Encode.Value</span></code></pre></div>
<p><small class="caption">Ye olde JSON values. Meh.</small></p>
<p>This meant that no event handlers could actually be tied into the elements. We had a workaround for that, but suffice to say it was not pretty.</p>
<p>So shortly after I had published the blog post <a href="https://twitter.com/czaplic">Evan Czaplicki</a> messaged me saying he’d like to have a video call on Elm Native UI sometime and in short explained that what I’d done just seemed awfully complex and that there was definitely a better way.</p>
<h2 id="from-ports-to-main">From ports to main</h2>
<p>A few days later, I had the video call with Evan. (He’s such a nice guy, by the way!) We chatted for about an hour on everything related to the project, but our main focus was the <code>main</code>. I described the reasons we had had to go with ports and not the normal Elm application way of letting <code>main</code> output the view.</p>
<p>Basically the thing is that <code>main</code> restricts the types that can pass through, because each allowed type needs to have specific support in the Elm runtime. Evan then went on to explain that supporting a new platform is something that can really get special help from the language. In fact, adding a new allowed type is actually very simple for him to do. He even showed me the parts of code I’d need to edit in order to make it work on my computer.</p>
<p><img src="https://media.giphy.com/media/3o8doT9BL7dgtolp7O/giphy.gif" /> <small class="caption">My reaction to the things Evan said (courtesy of <a href="https://giphy.com/gifs/foxinternational-reaction-simpsons-carl-3o8doT9BL7dgtolp7O">Giphy</a>)</small></p>
<p>While I was busy with work for a while, a helpful character by the name of Yusef Napora appeared. He single-handedly moved the project forward by <a href="https://github.com/elm-native-ui/elm-native-ui/pull/23">a major leap</a> simply because he was having fun!</p>
<p>I had failed to communicate the things I had discussed with Evan in the project readme so Yusef’s solution was based on making the compiler think the application is outputting <code>Html</code>. In reality it was using a monkey-patched virtual-dom package that could output the virtual tree for React Native to pick up. While an admirable feat of engineering and all in all a neat trick, this was not the <em>correct</em> way of doing things.</p>
<blockquote class="twitter-tweet" data-cards="hidden" data-lang="en">
<p lang="en" dir="ltr">
Hacking on <a href="https://twitter.com/elmlang"><span class="citation">@elmlang</span></a> and <a href="https://twitter.com/hashtag/reactnative?src=hash">#reactnative</a> is so much fun! Made the “random gif” from the elm architecture work last nite <a href="https://t.co/30C6aNAD34">pic.twitter.com/30C6aNAD34</a>
</p>
— Yusef Napora (<span class="citation">@sefnap</span>) <a href="https://twitter.com/sefnap/status/707940592144273409">March 10, 2016</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Meanwhile, I met Noah (a NoRedInk employee and an Elm contributor) while I was on a talking gig in Stockholm. I told him what me and Evan had talked in the video call, and that I hadn’t yet had the time to make the changes for the compiler and core necessary to make it happen. The next week he had took up on the challenge and <a href="https://github.com/elm-native-ui/elm-native-ui/pull/24">created the base</a> for our ideal future — first-class support for the React Native virtual tree at the language level.</p>
<p>Both of these things, the refactoring and new features Yusef had done, and the compiler modifications Noah made, eventually came together in the <a href="https://github.com/elm-native-ui/elm-native-ui/pull/25">great PR to change the future</a> of the project. After some discussion, I merged all of that stuff into <code>master</code>, effectively severing the continuity with older versions of Elm Native UI. From this moment on, the project would not compile with the official <code>elm-compiler</code>. On the other hand, the new version was on track with what Evan and I thought best, and the view functions were now aligned with how <code>elm-html</code> works.</p>
<h2 id="from-the-proof-of-concept-project-to-an-installable-package">From the proof-of-concept project to an installable package</h2>
<p>Yesterday I decided I would completely rethink the project structure. From the beginning, the Elm Native UI repository had been a React Native project with all the files that go with such a thing. This made sense when the goal was simply to make some kind of a proof-of-concept work. With the recent advances, Elm Native UI was finally looking worth being a library rather than just something to tinker with.</p>
<p>As depicted in the earlier post, the grand picture of how Elm Native UI should work is the following: “the Elm application is the only thing a developer needs to work on. React Native works as a ‘backend’ of sorts, relaying messages to and from the native app side to the Elm side.”</p>
<p><img src="./img/rn-elm-2.png" /> <small class="caption">How Elm Native UI ought to work</small></p>
<p>To make this happen, I made some <a href="https://github.com/elm-native-ui/elm-native-ui/pull/26">fundamental changes</a>.</p>
<ul>
<li>Moved all relevant package files to <code>./src</code></li>
<li>Moved usage example files to <code>./examples</code></li>
<li>Removed the React Native generated <code>android</code> and <code>ios</code> directories altogether</li>
<li>Renamed a bunch of stuff to be more intuitive for the end user</li>
</ul>
<p>In particular I renamed the module, and the outputted type, to <code>NativeUi</code>. This should make much more sense to people used to the way elm-html works:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">-- using elm-html</span>
main <span class="fu">:</span> <span class="dt">Signal</span> <span class="dt">Html</span>

<span class="co">-- and using elm-native-ui</span>
main <span class="fu">:</span> <span class="dt">Signal</span> <span class="dt">NativeUi</span></code></pre></div>
<p>I also forked and modified the <a href="https://github.com/elm-native-ui/elm-compiler">compiler</a> and <a href="https://github.com/elm-native-ui/core">core</a> to match these changes, and uploaded a pre-built version of the modified compiler so that not all people need to build it themselves to use Elm Native UI.</p>
<p>The coolest part of all this is that using the <a href="https://github.com/NoRedInk/elm-ops-tooling#elm_self_publish">self-publishing script</a> by Noah, people can now actually use Elm Native UI as a normal Elm package! You can init a React Native project of your own, then install the packages and start working on a mobile app in Elm. All the steps needed to start your own Elm Native UI project are documented in detail in the <a href="https://github.com/elm-native-ui/elm-native-ui#get-it-running">Get it running</a> section of the readme.</p>
<h2 id="whats-left-to-do">What’s left to do</h2>
<p>Apart from getting the official compiler and core to support NativeUi, there are a few other things to sort out still. Navigation is still an <a href="https://github.com/elm-native-ui/elm-native-ui/issues/11">open issue</a>, and there are some unchecked things in the <a href="https://github.com/elm-native-ui/elm-native-ui#to-do">To do</a>, among other things.</p>
<p>More than that though, I can’t really say if/when Elm Native UI could be published into <a href="http://package.elm-lang.org/">package.elm-lang.org</a>. Due to the <a href="https://facebook.github.io/react/blog/2015/05/22/react-native-release-process.html">volatile nature</a> of React Native itself, the published package would be very difficult to keep up to date and as high quality as expected from anything in the Elm package catalogue. For now, I think the best we can do is to wait and see how React Native evolves. Maybe in six months or a year, things will be more stable.</p>

    <div class="post-footer">
      Maybe your followers would be interested in this post?
      <a href="https://twitter.com/intent/tweet?original_referer=http%3A%2F%2Fohanhi.com%2Felm-native-ui-update.html&amp;text=Elm%20Native%20UI%3A%20The%20future%20of%20Elm%20%2B%20React%20Native&amp;url=http%3A%2F%2Fohanhi.com%2Felm-native-ui-update.html&amp;via=ohanhi" rel="nofollow" target="_blank">Get tweety with it!</a>
    </div>

  </section>
  <footer>
    <a href="https://twitter.com/ohanhi">Twitter</a>
    &ndash;
    <a href="https://github.com/ohanhi">GitHub</a>
  </footer>

  <script src="js/main.js"></script>
  <script>
  (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='https://www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-58943555-1');ga('send','pageview');
    </script>
  </body>
  </html>
